<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Binary Signal Bot with Save</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background-color: #0d0d0d;
      color: #00ff9f;
    }
    .glow {
      text-shadow: 0 0 10px #00ff9f, 0 0 20px #00ff9f;
    }
    .box {
      background-color: rgba(0, 0, 0, 0.9);
      border: 1px solid #00ff9f;
      border-radius: 10px;
      padding: 1rem;
    }
    input {
      background-color: #111;
      border: 1px solid #00ff9f;
      color: #00ff9f;
      padding: 4px 8px;
      border-radius: 6px;
      width: 250px;
    }
    button {
      background-color: #00ff9f;
      color: #000;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #00cc7a;
    }
  </style>
</head>
<body class="p-6">
  <h1 class="text-3xl glow mb-4">ğŸ¤– AI Binary Signal Bot (Real & OTC Market)</h1>

  <div class="mb-6 flex flex-wrap gap-4 items-end">
    <div>
      <label class="block mb-1 glow">ğŸ”‘ Bot Token:</label>
      <input id="botToken" type="text" placeholder="Enter Bot Token" autocomplete="off" />
    </div>
    <div>
      <label class="block mb-1 glow">ğŸ“¢ Channel ID:</label>
      <input id="channelId" type="text" placeholder="Enter Channel ID" autocomplete="off" />
    </div>
    <div>
      <button id="saveBtn">ğŸ’¾ Save</button>
    </div>
  </div>

  <div id="signal-box" class="box glow text-lg mb-4">
    Initializing analysis...
  </div>

  <div class="text-xl glow mb-4">
    â± Next signal in: <span id="seconds">60</span>s
  </div>

  <audio id="bg-music" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/08/19/audio_62f828f7a2.mp3?filename=ambient-technology-112788.mp3" type="audio/mpeg">
  </audio>

  <script>
    const botTokenInput = document.getElementById('botToken');
    const channelIdInput = document.getElementById('channelId');
    const saveBtn = document.getElementById('saveBtn');
    const signalBox = document.getElementById('signal-box');
    const secondsSpan = document.getElementById('seconds');
    const bgMusic = document.getElementById('bg-music');

    // Load saved token & channel ID from localStorage
    function loadSettings() {
      const savedToken = localStorage.getItem('botToken');
      const savedChannel = localStorage.getItem('channelId');

      if (savedToken) botTokenInput.value = savedToken;
      if (savedChannel) channelIdInput.value = savedChannel;
    }

    // Save token & channel ID to localStorage
    saveBtn.addEventListener('click', () => {
      const token = botTokenInput.value.trim();
      const channel = channelIdInput.value.trim();

      if (!token || !channel) {
        alert('Please enter both Bot Token and Channel ID before saving.');
        return;
      }

      localStorage.setItem('botToken', token);
      localStorage.setItem('channelId', channel);
      alert('Bot Token and Channel ID saved successfully!');
    });

    // Market lists and mindset messages
    const realMarkets = ["EUR/USD", "GBP/USD", "AUD/USD", "NZD/USD", "USD/JPY", "USD/CHF", "USD/CAD"];
    const otcMarkets = ["USD/BDT OTC", "USD/BRL OTC"];
    const mindsetLines = [
      "Stay calm. Trust the analysis.",
      "Smart money waits for the right moment.",
      "Be patient. One trade at a time.",
      "Donâ€™t overtrade. Wait for confirmation.",
      "Winning is waiting. Entry is everything.",
      "Trade what you see, not what you feel.",
      "Confidence comes from discipline."
    ];

    let currentIndex = 0;

    function getTodayMarketList() {
      const day = new Date().getDay();
      return (day === 0 || day === 6) ? otcMarkets : realMarkets;
    }

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function analyzeMarket() {
      const availableMarkets = getTodayMarketList();
      const market = availableMarkets[currentIndex % availableMarkets.length];
      currentIndex++;

      const rsi = getRandomInt(20, 80);
      const macd = (Math.random() * 4 - 2).toFixed(2);
      const volumeChange = getRandomInt(-10, 10);
      const priceMomentum = getRandomInt(-5, 5);

      let score = 0;
      if (rsi < 30) score += 2;
      else if (rsi > 70) score -= 2;

      if (macd > 0.3) score += 2;
      else if (macd < -0.3) score -= 2;

      if (volumeChange > 3) score += 1;
      else if (volumeChange < -3) score -= 1;

      if (priceMomentum > 1) score += 1;
      else if (priceMomentum < -1) score -= 1;

      let direction = "Buy";
      if (score < 0) direction = "Sell";
      else if (score === 0) direction = Math.random() > 0.5 ? "Buy" : "Sell";

      let baseAccuracy = 75 + Math.min(Math.abs(score) * 7, 20);
      baseAccuracy += getRandomInt(-5, 5);
      if (baseAccuracy > 99) baseAccuracy = 99;
      if (baseAccuracy < 70) baseAccuracy = 70;

      const timeframe = "1 Minute";

      const message = `ğŸ“¢ TRADER ALDI SIGNAL ğŸ“¢\n\n` +
                      `ğŸ“ˆ Market: ${market} (${timeframe})\n` +
                      `ğŸ“Š Direction: ${direction === "Buy" ? "ğŸŸ¢ Buy" : "ğŸ”´ Sell"}\n` +
                      `ğŸ¯ Accuracy: ${baseAccuracy}%\n\n` +
                      `ğŸ“Œ Stay disciplined. Trade smart!`;

      return {
        market,
        direction,
        accuracy: baseAccuracy,
        timeframe,
        message,
        rsi,
        macd,
        volumeChange,
        priceMomentum
      };
    }

    function updateUI(data) {
      signalBox.innerHTML = `
        <p>ğŸ“ˆ Market: <span class="text-yellow-300">${data.market}</span></p>
        <p>ğŸ“Š Direction: <span class="text-yellow-300">${data.direction === "Buy" ? "ğŸŸ¢ Buy" : "ğŸ”´ Sell"}</span></p>
        <p>â± Timeframe: <span class="text-yellow-300">${data.timeframe}</span></p>
        <p>ğŸ¯ Accuracy: <span class="text-yellow-300">${data.accuracy.toFixed(1)}%</span></p>
        <hr class="my-2 border-yellow-300/50" />
        <p>ğŸ” Analysis:</p>
        <ul class="list-disc ml-5">
          <li>RSI: ${data.rsi}</li>
          <li>MACD: ${data.macd}</li>
          <li>Volume Change: ${data.volumeChange}%</li>
          <li>Price Momentum: ${data.priceMomentum}</li>
        </ul>
      `;
    }

    function sendToTelegram(message) {
      const botToken = localStorage.getItem('botToken');
      const channelId = localStorage.getItem('channelId');

      if (!botToken || !channelId) {
        console.warn('Bot Token or Channel ID not set in localStorage');
        return;
      }

      const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
      fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          chat_id: channelId,
          text: message
        })
      }).catch(err => console.error("Telegram Error:", err));
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      utter.pitch = 1.1;
      utter.rate = 1;
      speechSynthesis.speak(utter);
    }

    function speakMindsetLine() {
      const line = mindsetLines[Math.floor(Math.random() * mindsetLines.length)];
      speak(line);
    }

    function startCountdown() {
      bgMusic.play();

      let mindsetInterval = setInterval(() => {
        speakMindsetLine();
      }, 15000);

      const countdownInterval = setInterval(() => {
        const now = new Date();
        const seconds = now.getSeconds();
        const remaining = 60 - seconds;

        secondsSpan.innerText = remaining;

        if (remaining === 10) {
          const data = analyzeMarket();
          updateUI(data);
          speak(data.message);
          sendToTelegram(data.message);

          bgMusic.pause();
          bgMusic.currentTime = 0;

          clearInterval(mindsetInterval);
        }

        if (remaining === 0) {
          bgMusic.play();
          mindsetInterval = setInterval(() => {
            speakMindsetLine();
          }, 15000);
        }
      }, 1000);
    }

    loadSettings();
    speak("Binary Bot activated. Preparing market environment.");
    startCountdown();
  </script>
</body>
</html>
